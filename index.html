<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุงูุทุงุจูุฑ ุงููุฏุฑุณู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        * { font-family: 'Cairo', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .animate-pulse-slow { animation: pulse 3s infinite; }
        .star-animation { animation: starGlow 2s ease-in-out infinite alternate; }
        @keyframes starGlow {
            from { transform: scale(1) rotate(0deg); }
            to { transform: scale(1.1) rotate(5deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white p-6 card-shadow">
        <div class="container mx-auto">
            <!-- Logo Area -->
            <div class="flex justify-center mb-4">
                <div id="logoContainer" class="flex gap-4">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
                        <span class="text-2xl">๐ซ</span>
                    </div>
                    <div id="logoContainer2" class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
                        <span class="text-2xl">๐</span>
                    </div>
                </div>
            </div>
            
            <!-- Title -->
            <h1 id="mainTitle" class="text-3xl font-bold text-center mb-4">ุงูุทุงุจูุฑ ุงููุฏุฑุณู</h1>
            
            <!-- Date and Time -->
            <div class="text-center mb-4">
                <div id="currentDateTime" class="text-lg font-semibold"></div>
            </div>
            
            <!-- Principal Name -->
            <div class="text-center mb-6">
                <p class="text-lg">ุงููุฏูุฑุฉ: <span id="principalName">ุฃ. ูุงุทูุฉ ุงูุฃุญูุฏ</span></p>
            </div>
            
            <!-- Stars Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="bg-white/20 rounded-lg p-4 text-center">
                    <div class="star-animation text-4xl mb-2">โญ</div>
                    <h3 class="font-bold text-sm">ูุฌู ุงูุทุงุจูุฑ - ุงูุตู</h3>
                    <h4 class="font-semibold text-xs mb-1">ุงูููู</h4>
                    <p id="dailyStar" class="text-lg font-semibold">ุงูุตู ุงูุฃูู ุฃ</p>
                </div>
                <div class="bg-white/20 rounded-lg p-4 text-center">
                    <div class="star-animation text-4xl mb-2">๐</div>
                    <h3 class="font-bold text-sm">ูุฌู ุงูุทุงุจูุฑ - ุงูุตู</h3>
                    <h4 class="font-semibold text-xs mb-1">ุงูุดูุฑ</h4>
                    <p id="monthlyStar" class="text-lg font-semibold">ุงูุตู ุงูุซุงูู ุจ</p>
                </div>
                <div class="bg-white/20 rounded-lg p-4 text-center">
                    <div class="star-animation text-4xl mb-2">๐</div>
                    <h3 class="font-bold text-sm">ูุฌู ุงูุญุถูุฑ</h3>
                    <h4 class="font-semibold text-xs mb-1">ุงูููู</h4>
                    <p id="dailyTeacherStar" class="text-lg font-semibold">ูุง ุชูุฌุฏ ูุนููุงุช</p>
                </div>
                <div class="bg-white/20 rounded-lg p-4 text-center">
                    <div class="star-animation text-4xl mb-2">๐</div>
                    <h3 class="font-bold text-sm">ูุฌู ุงูุญุถูุฑ</h3>
                    <h4 class="font-semibold text-xs mb-1">ุงูุดูุฑ</h4>
                    <p id="monthlyTeacherStar" class="text-lg font-semibold">ูุง ุชูุฌุฏ ูุนููุงุช</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex justify-center space-x-reverse space-x-8 py-4">
                <button onclick="showSection('teachers')" class="nav-btn bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                    ๐ฉโ๐ซ ุญุถูุฑ ุงููุนููุงุช
                </button>
                <button onclick="showSection('classes')" class="nav-btn bg-green-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                    ๐ ูุฌู ุงูุทุงุจูุฑ
                </button>
                <button onclick="showPasswordModal()" class="nav-btn bg-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-600 transition-colors">
                    โ๏ธ ุฅุฏุงุฑุฉ ุงููุธุงู
                </button>
            </div>
        </div>
    </nav>

    <!-- Statistics Bar -->
    <div id="statsBar" class="bg-white shadow-md py-4 mb-6">
        <div class="container mx-auto px-4">
            <div class="flex justify-center space-x-reverse space-x-8">
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="presentCount">0</div>
                    <div class="text-sm text-gray-600">ุญุงุถุฑุงุช</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-red-600" id="absentCount">0</div>
                    <div class="text-sm text-gray-600">ุบุงุฆุจุงุช</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-yellow-600" id="excusedCount">0</div>
                    <div class="text-sm text-gray-600">ุจุนุฐุฑ</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-orange-600" id="lateCount">0</div>
                    <div class="text-sm text-gray-600">ูุชุฃุฎุฑุงุช</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Selected Teacher Card -->
    <div id="selectedTeacherCard" class="hidden text-white shadow-lg mb-6 mx-4 rounded-lg transition-all duration-300">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="text-4xl">๐ฉโ๐ซ</div>
                    <div>
                        <h3 class="text-xl font-bold" id="selectedTeacherName">ุงุณู ุงููุนููุฉ</h3>
                        <p class="opacity-80" id="selectedTeacherClass">ุงูุตู</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div id="selectedTeacherStatus" class="px-4 py-2 rounded-full font-semibold">
                        ุงูุญุงูุฉ
                    </div>
                    <button onclick="clearSelection()" class="text-white hover:text-red-200 text-2xl">
                        โ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Status Indicator -->
    <div id="saveStatus" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2">
            <span class="text-sm">๐พ ุชู ุงูุญูุธ</span>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 pb-8">
        <!-- Teachers Section -->
        <div id="teachersSection" class="section">
            <!-- Teachers Status Lists -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- Present Teachers List -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-3 text-green-600">๐ฉโ๐ซ ุงูุญุงุถุฑุงุช</h3>
                    <div id="presentTeachersNames" class="flex flex-wrap gap-2 justify-center min-h-[60px]">
                        <!-- Present teachers will be shown here -->
                    </div>
                </div>
                
                <!-- Late Teachers List -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-3 text-orange-600">โฐ ุงููุชุฃุฎุฑุงุช</h3>
                    <div id="lateTeachersNames" class="flex flex-wrap gap-2 justify-center min-h-[60px]">
                        <!-- Late teachers will be shown here -->
                    </div>
                </div>
                
                <!-- Excused Teachers List -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-3 text-yellow-600">๐ ุงููุนุฐูุฑุงุช</h3>
                    <div id="excusedTeachersNames" class="flex flex-wrap gap-2 justify-center min-h-[60px]">
                        <!-- Excused teachers will be shown here -->
                    </div>
                </div>
                
                <!-- Absent Teachers List -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-3 text-red-600">โ ุงูุบุงุฆุจุงุช</h3>
                    <div id="absentTeachersNames" class="flex flex-wrap gap-2 justify-center min-h-[60px]">
                        <!-- Absent teachers will be shown here -->
                    </div>
                </div>
            </div>
            
            <div id="teachersGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Teacher cards will be generated here -->
            </div>
        </div>

        <!-- Classes Section -->
        <div id="classesSection" class="section hidden">
            <div id="classesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Class cards will be generated here -->
            </div>
        </div>

        <!-- Admin Section -->
        <div id="adminSection" class="section hidden">
            <!-- Teachers Table -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">๐ ุฌุฏูู ุงููุนููุงุช</h3>
                    <div class="flex gap-2">
                        <button onclick="copyTableData()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm">
                            ๐ ูุณุฎ ุงูุฌุฏูู
                        </button>
                        <button onclick="selectAllTable()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 text-sm">
                            โ ุชุญุฏูุฏ ุงููู
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table id="teachersTable" class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2 text-center">#</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ุงุณู ุงููุนููุฉ</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ุงูุตู</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ุงูุญุงูุฉ</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ููุงุท ุงูููู</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ููุงุท ุงูุดูุฑ</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="teachersTableBody">
                            <!-- Table rows will be generated here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4 text-sm text-gray-600">
                    <p>๐ก ููููู ูุณุฎ ุงูุฌุฏูู ูุงููุงู ุฃู ุชุญุฏูุฏ ุตููู ูุนููุฉ ููุณุฎูุง</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Data Management -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">๐ ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</h3>
                    <div class="space-y-4">
                        <input type="file" id="excelFile" accept=".xlsx,.xls" class="w-full p-3 border rounded-lg">
                        <button onclick="uploadExcel()" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600">
                            ุฑูุน ููู Excel
                        </button>
                        <button onclick="showAddTeacherForm()" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">
                            ุฅุถุงูุฉ ูุนููุฉ ูุฏููุงู
                        </button>
                        <button onclick="showBulkAddModal()" class="w-full bg-teal-500 text-white py-3 rounded-lg hover:bg-teal-600">
                            ๐ ุฌุฏูู ุฅุถุงูุฉ ุงููุนููุงุช
                        </button>
                        <button onclick="showAddClassForm()" class="w-full bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600">
                            ุฅุถุงูุฉ ุตู ูุฏููุงู
                        </button>
                    </div>
                </div>

                <!-- Certificates -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">๐ ุงูุดูุงุฏุงุช</h3>
                    <div class="space-y-4">
                        <button onclick="generateDailyCertificate()" class="w-full bg-yellow-500 text-white py-3 rounded-lg hover:bg-yellow-600">
                            ุดูุงุฏุฉ ูุฌู ุงูููู
                        </button>
                        <button onclick="generateMonthlyCertificate()" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600">
                            ุดูุงุฏุฉ ูุฌู ุงูุดูุฑ
                        </button>
                        <button onclick="generateTeacherCertificate()" class="w-full bg-pink-500 text-white py-3 rounded-lg hover:bg-pink-600">
                            ุดูุงุฏุฉ ูุนููุฉ ูุซุงููุฉ
                        </button>
                    </div>
                </div>

                <!-- Settings -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">โ๏ธ ุงูุฅุนุฏุงุฏุงุช</h3>
                    <div class="space-y-4">
                        <button onclick="showSettings()" class="w-full bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                            ุฅุนุฏุงุฏุงุช ุงููุธุงู
                        </button>
                        <button onclick="exportData()" class="w-full bg-indigo-500 text-white py-3 rounded-lg hover:bg-indigo-600">
                            ุชุตุฏูุฑ ุงูุจูุงูุงุช
                        </button>
                        <button onclick="resetSystem()" class="w-full bg-red-500 text-white py-3 rounded-lg hover:bg-red-600">
                            ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู
                        </button>
                        <button onclick="clearAllData()" class="w-full bg-red-700 text-white py-3 rounded-lg hover:bg-red-800">
                            ๐๏ธ ูุณุญ ุฌููุน ุงูุจูุงูุงุช
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">ุฅุนุฏุงุฏุงุช ุงููุธุงู</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">ุนููุงู ุงููุธุงู</label>
                    <input type="text" id="systemTitle" class="w-full p-3 border rounded-lg" value="ุงูุทุงุจูุฑ ุงููุฏุฑุณู">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ุงุณู ุงููุฏูุฑุฉ</label>
                    <input type="text" id="principalNameInput" class="w-full p-3 border rounded-lg" value="ุฃ. ูุงุทูุฉ ุงูุฃุญูุฏ">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ูููุฉ ูุฑูุฑ ุงููุธุงู</label>
                    <input type="password" id="systemPassword" class="w-full p-3 border rounded-lg" placeholder="ุฃุฏุฎู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ุฑูุน ุงูุดุนุงุฑ ุงูุฃูู</label>
                    <input type="file" id="logoFile" accept="image/*" class="w-full p-3 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ุฑูุน ุงูุดุนุงุฑ ุงูุซุงูู</label>
                    <input type="file" id="logoFile2" accept="image/*" class="w-full p-3 border rounded-lg">
                </div>
            </div>
            <div class="flex gap-4 mt-6">
                <button onclick="saveSettings()" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">
                    ุญูุธ
                </button>
                <button onclick="closeModal('settingsModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>

    <!-- Add Teacher Modal -->
    <div id="addTeacherModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">ุฅุถุงูุฉ ูุนููุฉ ุฌุฏูุฏุฉ</h3>
            <div class="space-y-4">
                <input type="text" id="newTeacherName" class="w-full p-3 border rounded-lg" placeholder="ุงุณู ุงููุนููุฉ">
                <input type="text" id="newTeacherClass" class="w-full p-3 border rounded-lg" placeholder="ุงูุตู">
            </div>
            <div class="flex gap-4 mt-6">
                <button onclick="addTeacher()" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">
                    ุฅุถุงูุฉ
                </button>
                <button onclick="closeModal('addTeacherModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div id="addClassModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">ุฅุถุงูุฉ ุตู ุฌุฏูุฏ</h3>
            <div class="space-y-4">
                <input type="text" id="newClassName" class="w-full p-3 border rounded-lg" placeholder="ุงุณู ุงูุตู">
            </div>
            <div class="flex gap-4 mt-6">
                <button onclick="addClass()" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">
                    ุฅุถุงูุฉ
                </button>
                <button onclick="closeModal('addClassModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">ุงูุชูุงุท ุตูุฑุฉ</h3>
            <video id="cameraVideo" class="w-full rounded-lg mb-4" autoplay></video>
            <canvas id="cameraCanvas" class="hidden"></canvas>
            <div class="flex gap-4">
                <button onclick="capturePhoto()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600">
                    ๐ธ ุงูุชูุงุท
                </button>
                <button onclick="closeCameraModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">๐ ูููุฉ ูุฑูุฑ ุฅุฏุงุฑุฉ ุงููุธุงู</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ</label>
                    <input type="password" id="adminPasswordInput" class="w-full p-3 border rounded-lg" placeholder="ูููุฉ ุงููุฑูุฑ">
                </div>
            </div>
            <div class="flex gap-4 mt-6">
                <button onclick="checkAdminPassword()" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">
                    ุฏุฎูู
                </button>
                <button onclick="closeModal('passwordModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">ุชุตุฏูุฑ ุงูุจูุงูุงุช</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">ููุน ุงูุชูุฑูุฑ</label>
                    <select id="exportType" class="w-full p-3 border rounded-lg">
                        <option value="daily">ูููู</option>
                        <option value="weekly">ุฃุณุจูุนู</option>
                        <option value="monthly">ุดูุฑู</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ุตูุบุฉ ุงูููู</label>
                    <select id="exportFormat" class="w-full p-3 border rounded-lg">
                        <option value="pdf">PDF</option>
                        <option value="excel">Excel</option>
                        <option value="image">ุตูุฑุฉ</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-4 mt-6">
                <button onclick="performExport()" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">
                    ุชุตุฏูุฑ
                </button>
                <button onclick="closeModal('exportModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Add Teachers Modal -->
    <div id="bulkAddModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold mb-6 text-center">๐ ุฌุฏูู ุฅุถุงูุฉ ุงููุนููุงุช</h3>
            
            <!-- Instructions -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h4 class="font-bold text-blue-800 mb-2">๐ก ููููุฉ ุงูุงุณุชุฎุฏุงู:</h4>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>โข ุงูุณุฎ ุงูุจูุงูุงุช ูู Excel (ุนููุฏูู: ุงุณู ุงููุนููุฉ ูุงูุตู)</li>
                    <li>โข ุงูุตู ุงูุจูุงูุงุช ูู ุงููุฑุจุน ุฃุฏูุงู</li>
                    <li>โข ุฃู ุฃุฏุฎู ุงูุจูุงูุงุช ูุฏููุงู ูู ุงูุฌุฏูู</li>
                    <li>โข ุงููุฑ "ุฅุถุงูุฉ ุงููุนููุงุช" ูุญูุธ ุงูุจูุงูุงุช</li>
                </ul>
            </div>
            
            <!-- Paste Area -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">๐ ุงูุตู ุงูุจูุงูุงุช ููุง (ูู Excel ุฃู ุฃู ูุตุฏุฑ ุขุฎุฑ):</label>
                <textarea id="bulkPasteArea" class="w-full h-32 p-3 border rounded-lg resize-none" 
                          placeholder="ุงูุตู ุงูุจูุงูุงุช ููุง... ูุซุงู:&#10;ุฃ. ุณุงุฑุฉ ูุญูุฏ	ุงูุตู ุงูุฃูู ุฃ&#10;ุฃ. ููุฑ ุฃุญูุฏ	ุงูุตู ุงูุซุงูู ุจ&#10;ุฃ. ูุงุทูุฉ ุนูู	ุงูุตู ุงูุซุงูุซ ุฃ"></textarea>
                <div class="flex gap-2 mt-2">
                    <button onclick="parsePastedData()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm">
                        ๐ฅ ุชุญููู ุงูุจูุงูุงุช
                    </button>
                    <button onclick="clearPasteArea()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 text-sm">
                        ๐๏ธ ูุณุญ
                    </button>
                </div>
            </div>
            
            <!-- Editable Table -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-bold">๐ ุฌุฏูู ุงููุนููุงุช</h4>
                    <div class="flex gap-2">
                        <button onclick="addEmptyRow()" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
                            โ ุฅุถุงูุฉ ุตู
                        </button>
                        <button onclick="clearTable()" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                            ๐๏ธ ูุณุญ ุงูุฌุฏูู
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto border rounded-lg">
                    <table id="bulkAddTable" class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2 text-center w-16">#</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ุงุณู ุงููุนููุฉ</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ุงูุตู</th>
                                <th class="border border-gray-300 px-4 py-2 text-center w-20">ุญุฐู</th>
                            </tr>
                        </thead>
                        <tbody id="bulkAddTableBody">
                            <!-- Rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button onclick="saveBulkTeachers()" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 font-semibold">
                    โ ุฅุถุงูุฉ ุงููุนููุงุช
                </button>
                <button onclick="closeModal('bulkAddModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables - Default data that will be replaced by saved data
        let selectedTeacherId = null;
        let teachers = [];
        let classes = [];
        let systemSettings = {
            title: 'ุงูุทุงุจูุฑ ุงููุฏุฑุณู',
            principalName: 'ุฃ. ูุงุทูุฉ ุงูุฃุญูุฏ',
            password: '1234',
            logo1: '',
            logo2: ''
        };

        // No default data - system starts empty

        // Initialize the system
        function init() {
            loadData(); // Load saved data first
            updateDateTime();
            setInterval(updateDateTime, 1000);
            renderTeachers();
            renderClasses();
            updateStatistics();
            updateTeachersListByStatus(); // Add this to show names immediately
            updateStars();
            loadSettings();
            
            // Set up auto-save every 30 seconds
            setInterval(autoSave, 30000);
            
            // Set up periodic backup save every 2 minutes
            setInterval(() => {
                saveData();
                console.log('๐ ุญูุธ ุฏูุฑู ููุจูุงูุงุช:', new Date().toLocaleTimeString('ar-SA'));
            }, 120000);
            
            console.log('๐ ุชู ุชุดุบูู ุงููุธุงู ูุน ุงูุญูุธ ุงูุชููุงุฆู ุงููุญุณู');
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('ar-SA', options);
        }

        // Show password modal
        function showPasswordModal() {
            showModal('passwordModal');
            document.getElementById('adminPasswordInput').focus();
        }

        // Check admin password
        function checkAdminPassword() {
            const password = document.getElementById('adminPasswordInput').value;
            if (password === '1234') {
                closeModal('passwordModal');
                showSection('admin');
                document.getElementById('adminPasswordInput').value = '';
            } else if (password !== '') {
                alert('ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ!');
                document.getElementById('adminPasswordInput').value = '';
                document.getElementById('adminPasswordInput').focus();
            }
        }

        // Show section
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'bg-green-600', 'bg-purple-600');
                btn.classList.add('bg-blue-500', 'bg-green-500', 'bg-purple-500');
            });
            
            // If showing admin section, render the teachers table
            if (section === 'admin') {
                renderTeachersTable();
            }
        }

        // Render teachers
        function renderTeachers() {
            const grid = document.getElementById('teachersGrid');
            grid.innerHTML = '';
            
            // Show welcome message if no teachers
            if (teachers.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md mx-auto">
                            <div class="text-6xl mb-4">๐ฉโ๐ซ</div>
                            <h3 class="text-2xl font-bold mb-4 text-gray-700">ูุฑุญุจุงู ุจู ูู ูุธุงู ุงูุทุงุจูุฑ ุงููุฏุฑุณู!</h3>
                            <p class="text-gray-600 mb-6">ูู ูุชู ุฅุถุงูุฉ ุฃู ูุนููุงุช ุจุนุฏ</p>
                            <div class="space-y-3">
                                <button onclick="showPasswordModal()" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 font-semibold">
                                    ๐ง ุงุฐูุจ ุฅูู ุงูุฅุนุฏุงุฏุงุช ูุฅุถุงูุฉ ุงููุนููุงุช
                                </button>
                                <p class="text-sm text-gray-500">ููููู ุฅุถุงูุฉ ุงููุนููุงุช ุนุจุฑ:</p>
                                <div class="text-xs text-gray-400 space-y-1">
                                    <div>๐ ุฑูุน ููู Excel</div>
                                    <div>๐ ุฌุฏูู ุฅุถุงูุฉ ุงููุนููุงุช</div>
                                    <div>โ๏ธ ุฅุถุงูุฉ ูุนููุฉ ูุฏููุงู</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            teachers.forEach(teacher => {
                const statusColors = {
                    present: 'bg-green-500',
                    absent: 'bg-red-500',
                    excused: 'bg-yellow-500',
                    late: 'bg-orange-500'
                };
                
                const statusTexts = {
                    present: 'ุญุงุถุฑุฉ',
                    absent: 'ุบุงุฆุจุฉ',
                    excused: 'ุจุนุฐุฑ',
                    late: 'ูุชุฃุฎุฑุฉ'
                };

                // Card background colors based on status
                const cardColors = {
                    present: 'bg-green-50 border-2 border-green-200',
                    absent: 'bg-red-50 border-2 border-red-200',
                    excused: 'bg-yellow-50 border-2 border-yellow-200',
                    late: 'bg-orange-50 border-2 border-orange-200'
                };

                const card = document.createElement('div');
                card.className = `${cardColors[teacher.status]} rounded-lg shadow-lg p-6 card-shadow cursor-pointer transition-all duration-300 hover:shadow-xl ${selectedTeacherId === teacher.id ? 'ring-4 ring-blue-500' : ''}`;
                card.onclick = () => selectTeacher(teacher.id);
                card.innerHTML = `
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2 transition-transform duration-300 hover:scale-110">๐ฉโ๐ซ</div>
                        <h3 class="text-xl font-bold">${teacher.name}</h3>
                        <p class="text-gray-600">${teacher.class}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <button onclick="updateTeacherStatus(${teacher.id}, 'present')" 
                                class="py-2 px-3 rounded text-white text-sm ${teacher.status === 'present' ? 'bg-green-600' : 'bg-green-400'} hover:bg-green-600">
                            ุญุงุถุฑุฉ
                        </button>
                        <button onclick="updateTeacherStatus(${teacher.id}, 'absent')" 
                                class="py-2 px-3 rounded text-white text-sm ${teacher.status === 'absent' ? 'bg-red-600' : 'bg-red-400'} hover:bg-red-600">
                            ุบุงุฆุจุฉ
                        </button>
                        <button onclick="updateTeacherStatus(${teacher.id}, 'excused')" 
                                class="py-2 px-3 rounded text-white text-sm ${teacher.status === 'excused' ? 'bg-yellow-600' : 'bg-yellow-400'} hover:bg-yellow-600">
                            ุจุนุฐุฑ
                        </button>
                        <button onclick="updateTeacherStatus(${teacher.id}, 'late')" 
                                class="py-2 px-3 rounded text-white text-sm ${teacher.status === 'late' ? 'bg-orange-600' : 'bg-orange-400'} hover:bg-orange-600">
                            ูุชุฃุฎุฑุฉ
                        </button>
                    </div>
                    
                    <div class="text-center mb-4">
                        <span class="inline-block px-3 py-1 rounded-full text-white text-sm ${statusColors[teacher.status]}">
                            ${statusTexts[teacher.status]}
                        </span>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="resetTeacher(${teacher.id})" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600 text-sm">
                            ุฅุนุงุฏุฉ ุชุนููู
                        </button>
                        <button onclick="openCamera()" class="flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600 text-sm">
                            ๐ธ ูุงููุฑุง
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
            
            // Update the status lists after rendering
            updateTeachersListByStatus();
        }

        // Render classes
        function renderClasses() {
            const grid = document.getElementById('classesGrid');
            grid.innerHTML = '';
            
            // Show welcome message if no classes
            if (classes.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md mx-auto">
                            <div class="text-6xl mb-4">๐ซ</div>
                            <h3 class="text-2xl font-bold mb-4 text-gray-700">ูุง ุชูุฌุฏ ุตููู ุจุนุฏ!</h3>
                            <p class="text-gray-600 mb-6">ุณูุชู ุฅูุดุงุก ุงูุตููู ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ุงููุนููุงุช</p>
                            <button onclick="showPasswordModal()" class="bg-purple-500 text-white py-3 px-6 rounded-lg hover:bg-purple-600 font-semibold">
                                ๐ง ุงุฐูุจ ุฅูู ุงูุฅุนุฏุงุฏุงุช ูุฅุถุงูุฉ ุงููุนููุงุช ูุงูุตููู
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            classes.forEach(classItem => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-lg p-6 card-shadow';
                card.innerHTML = `
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">๐ซ</div>
                        <h3 class="text-xl font-bold">${classItem.name}</h3>
                        <div class="text-sm text-gray-600 mt-2">
                            <div>ููุงุท ุงูููู: <span class="font-bold text-blue-600">${classItem.dailyPoints}</span></div>
                            <div>ููุงุท ุงูุดูุฑ: <span class="font-bold text-green-600">${classItem.monthlyPoints}</span></div>
                        </div>
                    </div>
                    
                    <div class="space-y-3 mb-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">ุงููุฏูุก:</span>
                            <div class="flex gap-1">
                                ${[1,2,3,4,5].map(i => `
                                    <button onclick="updateRating(${classItem.id}, 'quiet', ${i})" 
                                            class="w-6 h-6 rounded-full text-xs ${i <= classItem.ratings.quiet ? 'bg-yellow-400' : 'bg-gray-200'}">
                                        โญ
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm">ุณุฑุนุฉ ุงูุงุตุทูุงู:</span>
                            <div class="flex gap-1">
                                ${[1,2,3,4,5].map(i => `
                                    <button onclick="updateRating(${classItem.id}, 'speed', ${i})" 
                                            class="w-6 h-6 rounded-full text-xs ${i <= classItem.ratings.speed ? 'bg-blue-400' : 'bg-gray-200'}">
                                        โก
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm">ุงูุงุตุทูุงู:</span>
                            <div class="flex gap-1">
                                ${[1,2,3,4,5].map(i => `
                                    <button onclick="updateRating(${classItem.id}, 'alignment', ${i})" 
                                            class="w-6 h-6 rounded-full text-xs ${i <= classItem.ratings.alignment ? 'bg-green-400' : 'bg-gray-200'}">
                                        ๐
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm">ูุณุชูู ุงูุตูุช:</span>
                            <div class="flex gap-1">
                                ${[1,2,3,4,5].map(i => `
                                    <button onclick="updateRating(${classItem.id}, 'noise', ${i})" 
                                            class="w-6 h-6 rounded-full text-xs ${i <= classItem.ratings.noise ? 'bg-red-400' : 'bg-gray-200'}">
                                        ๐
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm">ุงููุธุงูุฉ:</span>
                            <div class="flex gap-1">
                                ${[1,2,3,4,5].map(i => `
                                    <button onclick="updateRating(${classItem.id}, 'cleanliness', ${i})" 
                                            class="w-6 h-6 rounded-full text-xs ${i <= classItem.ratings.cleanliness ? 'bg-purple-400' : 'bg-gray-200'}">
                                        โจ
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="addPoints(${classItem.id}, 5)" class="flex-1 bg-green-500 text-white py-2 rounded hover:bg-green-600 text-sm">
                            +5 ููุงุท
                        </button>
                        <button onclick="addPoints(${classItem.id}, -2)" class="flex-1 bg-red-500 text-white py-2 rounded hover:bg-red-600 text-sm">
                            -2 ููุงุท
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Select teacher
        function selectTeacher(teacherId) {
            selectedTeacherId = teacherId;
            const teacher = teachers.find(t => t.id === teacherId);
            if (teacher) {
                // Show selected teacher card
                const selectedCard = document.getElementById('selectedTeacherCard');
                selectedCard.classList.remove('hidden');
                document.getElementById('selectedTeacherName').textContent = teacher.name;
                document.getElementById('selectedTeacherClass').textContent = teacher.class;
                
                // Update status display and card background color
                const statusColors = {
                    present: 'bg-green-500',
                    absent: 'bg-red-500',
                    excused: 'bg-yellow-500',
                    late: 'bg-orange-500'
                };
                
                const cardBackgrounds = {
                    present: 'bg-gradient-to-r from-green-500 to-green-600',
                    absent: 'bg-gradient-to-r from-red-500 to-red-600',
                    excused: 'bg-gradient-to-r from-yellow-500 to-yellow-600',
                    late: 'bg-gradient-to-r from-orange-500 to-orange-600'
                };
                
                const statusTexts = {
                    present: 'ุญุงุถุฑุฉ',
                    absent: 'ุบุงุฆุจุฉ',
                    excused: 'ุจุนุฐุฑ',
                    late: 'ูุชุฃุฎุฑุฉ'
                };
                
                // Update card background
                selectedCard.className = `text-white shadow-lg mb-6 mx-4 rounded-lg transition-all duration-300 ${cardBackgrounds[teacher.status]}`;
                
                const statusElement = document.getElementById('selectedTeacherStatus');
                statusElement.className = `px-4 py-2 rounded-full font-semibold bg-white bg-opacity-20`;
                statusElement.textContent = statusTexts[teacher.status];
                
                // Re-render to show selection
                renderTeachers();
            }
        }

        // Clear selection
        function clearSelection() {
            selectedTeacherId = null;
            document.getElementById('selectedTeacherCard').classList.add('hidden');
            renderTeachers();
        }

        // Update teacher status
        function updateTeacherStatus(teacherId, status) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (teacher) {
                const oldStatus = teacher.status;
                teacher.status = status;
                
                // Award points based on status
                if (status === 'present' && oldStatus !== 'present') {
                    teacher.dailyPoints += 5;
                    teacher.monthlyPoints += 5;
                } else if (status === 'late' && oldStatus !== 'late') {
                    teacher.dailyPoints += 2;
                    teacher.monthlyPoints += 2;
                } else if (status === 'excused' && oldStatus !== 'excused') {
                    teacher.dailyPoints += 3;
                    teacher.monthlyPoints += 3;
                } else if (status === 'absent') {
                    // Reset daily points for absent teachers
                    teacher.dailyPoints = 0;
                }
                
                // Update selected teacher card if this teacher is selected
                if (selectedTeacherId === teacherId) {
                    selectTeacher(teacherId);
                }
                
                renderTeachers();
                updateStatistics();
                updatePresentTeachersList();
                updateStars();
                
                // Force immediate save after status change
                saveData();
            }
        }

        // Reset teacher
        function resetTeacher(teacherId) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (teacher) {
                teacher.status = 'present';
                renderTeachers();
                updateStatistics();
                saveData();
            }
        }

        // Update class rating
        function updateRating(classId, category, rating) {
            const classItem = classes.find(c => c.id === classId);
            if (classItem) {
                classItem.ratings[category] = rating;
                updateClassPoints(classId);
                renderClasses();
                updateStars();
                saveData();
            }
        }

        // Add points to class
        function addPoints(classId, points) {
            const classItem = classes.find(c => c.id === classId);
            if (classItem) {
                classItem.dailyPoints += points;
                classItem.monthlyPoints += points;
                if (classItem.dailyPoints < 0) classItem.dailyPoints = 0;
                if (classItem.monthlyPoints < 0) classItem.monthlyPoints = 0;
                renderClasses();
                updateStars();
                saveData();
            }
        }

        // Update class points based on ratings
        function updateClassPoints(classId) {
            const classItem = classes.find(c => c.id === classId);
            if (classItem) {
                const totalRating = Object.values(classItem.ratings).reduce((sum, rating) => sum + rating, 0);
                classItem.dailyPoints = totalRating;
                classItem.monthlyPoints += totalRating - 15; // Assuming 15 is the base
            }
        }

        // Update statistics
        function updateStatistics() {
            const present = teachers.filter(t => t.status === 'present').length;
            const absent = teachers.filter(t => t.status === 'absent').length;
            const excused = teachers.filter(t => t.status === 'excused').length;
            const late = teachers.filter(t => t.status === 'late').length;
            
            document.getElementById('presentCount').textContent = present;
            document.getElementById('absentCount').textContent = absent;
            document.getElementById('excusedCount').textContent = excused;
            document.getElementById('lateCount').textContent = late;
            
            // Update present teachers list
            updatePresentTeachersList();
        }

        // Update all teachers lists by status
        function updatePresentTeachersList() {
            updateTeachersListByStatus();
        }
        
        function updateTeachersListByStatus() {
            // Present teachers
            const presentTeachers = teachers.filter(t => t.status === 'present');
            const presentContainer = document.getElementById('presentTeachersNames');
            
            if (presentTeachers.length === 0) {
                presentContainer.innerHTML = '<p class="text-gray-500 text-center text-xs">ูุง ููุฌุฏ</p>';
            } else {
                presentContainer.innerHTML = presentTeachers.map(teacher => 
                    `<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                        ${teacher.name}
                    </span>`
                ).join('');
            }
            
            // Late teachers
            const lateTeachers = teachers.filter(t => t.status === 'late');
            const lateContainer = document.getElementById('lateTeachersNames');
            
            if (lateTeachers.length === 0) {
                lateContainer.innerHTML = '<p class="text-gray-500 text-center text-xs">ูุง ููุฌุฏ</p>';
            } else {
                lateContainer.innerHTML = lateTeachers.map(teacher => 
                    `<span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-medium">
                        ${teacher.name}
                    </span>`
                ).join('');
            }
            
            // Excused teachers
            const excusedTeachers = teachers.filter(t => t.status === 'excused');
            const excusedContainer = document.getElementById('excusedTeachersNames');
            
            if (excusedTeachers.length === 0) {
                excusedContainer.innerHTML = '<p class="text-gray-500 text-center text-xs">ูุง ููุฌุฏ</p>';
            } else {
                excusedContainer.innerHTML = excusedTeachers.map(teacher => 
                    `<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">
                        ${teacher.name}
                    </span>`
                ).join('');
            }
            
            // Absent teachers
            const absentTeachers = teachers.filter(t => t.status === 'absent');
            const absentContainer = document.getElementById('absentTeachersNames');
            
            if (absentTeachers.length === 0) {
                absentContainer.innerHTML = '<p class="text-gray-500 text-center text-xs">ูุง ููุฌุฏ</p>';
            } else {
                absentContainer.innerHTML = absentTeachers.map(teacher => 
                    `<span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">
                        ${teacher.name}
                    </span>`
                ).join('');
            }
        }

        // Update stars
        function updateStars() {
            // Class stars
            if (classes.length > 0) {
                const dailyWinner = classes.reduce((prev, current) => 
                    (prev.dailyPoints > current.dailyPoints) ? prev : current
                );
                const monthlyWinner = classes.reduce((prev, current) => 
                    (prev.monthlyPoints > current.monthlyPoints) ? prev : current
                );
                
                document.getElementById('dailyStar').textContent = dailyWinner.name;
                document.getElementById('monthlyStar').textContent = monthlyWinner.name;
            } else {
                document.getElementById('dailyStar').textContent = 'ูุง ุชูุฌุฏ ุตููู';
                document.getElementById('monthlyStar').textContent = 'ูุง ุชูุฌุฏ ุตููู';
            }
            
            // Teacher stars
            updateTeacherStars();
        }
        
        // Update teacher stars
        function updateTeacherStars() {
            if (teachers.length === 0) {
                document.getElementById('dailyTeacherStar').textContent = 'ูุง ุชูุฌุฏ ูุนููุงุช';
                document.getElementById('monthlyTeacherStar').textContent = 'ูุง ุชูุฌุฏ ูุนููุงุช';
                return;
            }
            
            const presentTeachers = teachers.filter(t => t.status === 'present');
            const dailyTeacherWinner = presentTeachers.length > 0 ? 
                presentTeachers.reduce((prev, current) => 
                    (prev.dailyPoints > current.dailyPoints) ? prev : current
                ) : null;
            
            const monthlyTeacherWinner = teachers.length > 0 ? 
                teachers.reduce((prev, current) => 
                    (prev.monthlyPoints > current.monthlyPoints) ? prev : current
                ) : null;
            
            document.getElementById('dailyTeacherStar').textContent = 
                dailyTeacherWinner ? dailyTeacherWinner.name : 'ูุง ุชูุฌุฏ ูุนููุงุช ุญุงุถุฑุงุช';
            document.getElementById('monthlyTeacherStar').textContent = 
                monthlyTeacherWinner ? monthlyTeacherWinner.name : 'ูุง ุชูุฌุฏ ูุนููุงุช';
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showSettings() {
            showModal('settingsModal');
        }

        function showAddTeacherForm() {
            showModal('addTeacherModal');
        }

        function showAddClassForm() {
            showModal('addClassModal');
        }

        function showBulkAddModal() {
            showModal('bulkAddModal');
            // Initialize with a few empty rows
            clearTable();
            for (let i = 0; i < 5; i++) {
                addEmptyRow();
            }
        }

        // Settings functions
        function saveSettings() {
            const title = document.getElementById('systemTitle').value;
            const principalName = document.getElementById('principalNameInput').value;
            const password = document.getElementById('systemPassword').value;
            
            // Update system settings
            systemSettings.title = title;
            systemSettings.principalName = principalName;
            if (password) systemSettings.password = password;
            
            // Update display immediately
            document.getElementById('mainTitle').textContent = title;
            document.getElementById('principalName').textContent = principalName;
            
            // Handle logo files
            const logoFile = document.getElementById('logoFile').files[0];
            const logoFile2 = document.getElementById('logoFile2').files[0];
            
            let logosToProcess = 0;
            let logosProcessed = 0;
            
            if (logoFile) logosToProcess++;
            if (logoFile2) logosToProcess++;
            
            function checkAndSave() {
                logosProcessed++;
                if (logosProcessed >= logosToProcess || logosToProcess === 0) {
                    // Force save settings
                    saveData();
                    
                    // Save again after a short delay to ensure persistence
                    setTimeout(() => {
                        saveData();
                        console.log('๐พ ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจุดูู ุฏุงุฆู');
                    }, 300);
                    
                    closeModal('settingsModal');
                    alert('โ ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ!\n\n๐พ ุงูุฅุนุฏุงุฏุงุช ูุญููุธุฉ ุจุดูู ุฏุงุฆู ููู ุชุชุบูุฑ ุนูุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุฃู ุงุณุชุฎุฏุงู ุฃุฌูุฒุฉ ูุฎุชููุฉ!');
                }
            }
            
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoContainer = document.getElementById('logoContainer');
                    logoContainer.innerHTML = `<img src="${e.target.result}" alt="ุดุนุงุฑ ุฃูู" class="w-16 h-16 rounded-full object-cover">`;
                    systemSettings.logo1 = e.target.result;
                    checkAndSave();
                };
                reader.readAsDataURL(logoFile);
            }
            
            if (logoFile2) {
                const reader2 = new FileReader();
                reader2.onload = function(e) {
                    const logoContainer2 = document.getElementById('logoContainer2');
                    logoContainer2.innerHTML = `<img src="${e.target.result}" alt="ุดุนุงุฑ ุซุงูู" class="w-16 h-16 rounded-full object-cover">`;
                    systemSettings.logo2 = e.target.result;
                    checkAndSave();
                };
                reader2.readAsDataURL(logoFile2);
            }
            
            // If no logos to process, save immediately
            if (logosToProcess === 0) {
                checkAndSave();
            }
        }

        // Add teacher
        function addTeacher() {
            const name = document.getElementById('newTeacherName').value;
            const className = document.getElementById('newTeacherClass').value;
            
            if (name && className) {
                const newId = Math.max(...teachers.map(t => t.id)) + 1;
                teachers.push({
                    id: newId,
                    name: name,
                    class: className,
                    status: 'absent',
                    dailyPoints: 0,
                    monthlyPoints: 0
                });
                
                renderTeachers();
                updateStatistics();
                saveData();
                closeModal('addTeacherModal');
                
                document.getElementById('newTeacherName').value = '';
                document.getElementById('newTeacherClass').value = '';
                
                alert('ุชู ุฅุถุงูุฉ ุงููุนููุฉ ุจูุฌุงุญ!');
            }
        }

        // Add class
        function addClass() {
            const name = document.getElementById('newClassName').value;
            
            if (name) {
                const newId = Math.max(...classes.map(c => c.id)) + 1;
                classes.push({
                    id: newId,
                    name: name,
                    dailyPoints: 0,
                    monthlyPoints: 0,
                    ratings: { quiet: 3, speed: 3, alignment: 3, noise: 3, cleanliness: 3 }
                });
                
                renderClasses();
                updateStars();
                saveData();
                closeModal('addClassModal');
                
                document.getElementById('newClassName').value = '';
                
                alert('ุชู ุฅุถุงูุฉ ุงูุตู ุจูุฌุงุญ!');
            }
        }

        // Camera functions
        function openCamera() {
            showModal('cameraModal');
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    document.getElementById('cameraVideo').srcObject = stream;
                })
                .catch(err => {
                    alert('ูุง ูููู ุงููุตูู ูููุงููุฑุง');
                    closeModal('cameraModal');
                });
        }

        function capturePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            // Here you would typically save the photo
            alert('ุชู ุงูุชูุงุท ุงูุตูุฑุฉ ุจูุฌุงุญ!');
            closeCameraModal();
        }

        function closeCameraModal() {
            const video = document.getElementById('cameraVideo');
            const stream = video.srcObject;
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            closeModal('cameraModal');
        }

        // Excel upload
        function uploadExcel() {
            const file = document.getElementById('excelFile').files[0];
            if (!file) {
                alert('ูุฑุฌู ุงุฎุชูุงุฑ ููู Excel');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    
                    // First try to read with headers
                    const namedData = XLSX.utils.sheet_to_json(worksheet);
                    console.log('ุงูุจูุงูุงุช ุงูููุฑูุกุฉ:', namedData);
                    
                    // Clear existing data
                    teachers = [];
                    classes = [];
                    
                    let teachersAdded = 0;
                    let classesAdded = 0;
                    
                    if (namedData.length > 0) {
                        // Get all possible column names from the first row
                        const headers = Object.keys(namedData[0]);
                        console.log('ุฃุณูุงุก ุงูุฃุนูุฏุฉ:', headers);
                        
                        // Find the correct column names
                        let teacherColumn = null;
                        let classColumn = null;
                        
                        // Look for teacher column
                        const teacherPossibleNames = ['ุงููุนููุงุช', 'ุงุณู ุงููุนููุฉ', 'ุงููุนููุฉ', 'ุงูุงุณู', 'Name', 'Teacher', 'ูุนููุฉ'];
                        for (let header of headers) {
                            if (teacherPossibleNames.some(name => header.includes(name) || name.includes(header))) {
                                teacherColumn = header;
                                break;
                            }
                        }
                        
                        // Look for class column
                        const classPossibleNames = ['ุงูุตู', 'Class', 'ุงููุตู', 'Grade', 'ุตู'];
                        for (let header of headers) {
                            if (classPossibleNames.some(name => header.includes(name) || name.includes(header))) {
                                classColumn = header;
                                break;
                            }
                        }
                        
                        console.log('ุนููุฏ ุงููุนููุงุช:', teacherColumn);
                        console.log('ุนููุฏ ุงูุตููู:', classColumn);
                        
                        if (teacherColumn && classColumn) {
                            // Process each row
                            namedData.forEach((row, index) => {
                                let teacherName = row[teacherColumn];
                                let className = row[classColumn];
                                
                                // Clean up the data
                                if (teacherName) teacherName = teacherName.toString().trim();
                                if (className) className = className.toString().trim();
                                
                                // Skip empty rows or headers
                                if (teacherName && className && 
                                    !teacherPossibleNames.includes(teacherName) && 
                                    !classPossibleNames.includes(className)) {
                                    
                                    // Add teacher
                                    teachers.push({
                                        id: teachers.length + 1,
                                        name: teacherName,
                                        class: className,
                                        status: 'absent',
                                        dailyPoints: 0,
                                        monthlyPoints: 0
                                    });
                                    teachersAdded++;
                                    
                                    // Add unique classes
                                    if (!classes.find(c => c.name === className)) {
                                        classes.push({
                                            id: classes.length + 1,
                                            name: className,
                                            dailyPoints: 0,
                                            monthlyPoints: 0,
                                            ratings: { quiet: 3, speed: 3, alignment: 3, noise: 3, cleanliness: 3 }
                                        });
                                        classesAdded++;
                                    }
                                }
                            });
                        } else {
                            // If headers not found, try with array format
                            const arrayData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            console.log('ุงูุจูุงูุงุช ููุตูููุฉ:', arrayData);
                            
                            // Skip header row and process data
                            for (let i = 1; i < arrayData.length; i++) {
                                const row = arrayData[i];
                                
                                // Assume first column is teachers, second is classes
                                let teacherName = row[0];
                                let className = row[1];
                                
                                // Clean up the data
                                if (teacherName) teacherName = teacherName.toString().trim();
                                if (className) className = className.toString().trim();
                                
                                if (teacherName && className) {
                                    // Add teacher
                                    teachers.push({
                                        id: teachers.length + 1,
                                        name: teacherName,
                                        class: className,
                                        status: 'absent',
                                        dailyPoints: 0,
                                        monthlyPoints: 0
                                    });
                                    teachersAdded++;
                                    
                                    // Add unique classes
                                    if (!classes.find(c => c.name === className)) {
                                        classes.push({
                                            id: classes.length + 1,
                                            name: className,
                                            dailyPoints: 0,
                                            monthlyPoints: 0,
                                            ratings: { quiet: 3, speed: 3, alignment: 3, noise: 3, cleanliness: 3 }
                                        });
                                        classesAdded++;
                                    }
                                }
                            }
                        }
                    }
                    
                    if (teachersAdded > 0) {
                        // Force immediate save to ensure data persistence
                        saveData();
                        
                        // Update all displays
                        renderTeachers();
                        renderClasses();
                        updateStatistics();
                        updateStars();
                        
                        // Save again after rendering to ensure everything is captured
                        setTimeout(() => {
                            saveData();
                            console.log('๐ ุชู ุญูุธ ุงูุจูุงูุงุช ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ุงูุชุญุฏูุซ');
                        }, 500);
                        
                        alert(`โ ุชู ุฑูุน ููู Excel ูุญูุธู ุจูุฌุงุญ!\n๐ ุชู ุฅุถุงูุฉ ${teachersAdded} ูุนููุฉ\n๐ซ ุชู ุฅุถุงูุฉ ${classesAdded} ุตู\n\n๐พ ุงูุจูุงูุงุช ูุญููุธุฉ ุจุดูู ุฏุงุฆู ููู ุชุฎุชูู ุนูุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุฃู ุงุณุชุฎุฏุงู ุฃุฌูุฒุฉ ูุฎุชููุฉ!\n\nโจ ุงูุจูุงูุงุช ุฌุงูุฒุฉ ูู ุญุถูุฑ ุงููุนููุงุช ููุฌู ุงูุทุงุจูุฑ!`);
                        
                        // Clear the file input
                        document.getElementById('excelFile').value = '';
                        
                        // Show teachers section automatically
                        showSection('teachers');
                    } else {
                        alert('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุตุงูุญุฉ ูู ุงูููู.\n\n๐ ุชุฃูุฏ ูู ูุฌูุฏ ุนููุฏูู:\nโข ุนููุฏ ุงููุนููุงุช (ุฃุณูุงุก ุงููุนููุงุช)\nโข ุนููุฏ ุงูุตู (ุฃุณูุงุก ุงูุตููู)\n\n๐ก ูููู ุฃู ุชููู ุฃุณูุงุก ุงูุฃุนูุฏุฉ: "ุงููุนููุงุช" ู "ุงูุตู" ุฃู "ุงุณู ุงููุนููุฉ" ู "ุงูุตู"');
                    }
                    
                } catch (error) {
                    console.error('ุฎุทุฃ ูู Excel:', error);
                    alert('โ ุฎุทุฃ ูู ูุฑุงุกุฉ ููู Excel.\n\n๐ ุชุฃูุฏ ูู:\nโข ุงูููู ุจุตูุบุฉ .xlsx ุฃู .xls\nโข ูุฌูุฏ ุนููุฏูู ูููุนููุงุช ูุงูุตููู\nโข ุนุฏู ูุฌูุฏ ุฎูุงูุง ูุงุฑุบุฉ ูู ุงูุจูุงูุงุช ุงููููุฉ');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Certificate generation
        function generateDailyCertificate() {
            const winner = classes.reduce((prev, current) => 
                (prev.dailyPoints > current.dailyPoints) ? prev : current
            );
            generateCertificate(winner.name, 'ูุฌู ุงูุทุงุจูุฑ ููุฐุง ุงูููู');
        }

        function generateMonthlyCertificate() {
            const winner = classes.reduce((prev, current) => 
                (prev.monthlyPoints > current.monthlyPoints) ? prev : current
            );
            generateCertificate(winner.name, 'ูุฌู ุงูุทุงุจูุฑ ููุฐุง ุงูุดูุฑ');
        }

        function generateTeacherCertificate() {
            const winner = teachers.reduce((prev, current) => 
                (prev.monthlyPoints > current.monthlyPoints) ? prev : current
            );
            generateCertificate(winner.name, 'ุงููุนููุฉ ุงููุซุงููุฉ');
        }

        function generateCertificate(name, title) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add certificate content
            doc.setFontSize(20);
            doc.text('ุดูุงุฏุฉ ุชูุฏูุฑ', 105, 50, { align: 'center' });
            
            doc.setFontSize(16);
            doc.text(title, 105, 80, { align: 'center' });
            
            doc.setFontSize(14);
            doc.text(`ุชูููุญ ูุฐู ุงูุดูุงุฏุฉ ุฅูู: ${name}`, 105, 110, { align: 'center' });
            
            doc.text(`ุงููุฏูุฑุฉ: ${systemSettings.principalName}`, 105, 200, { align: 'center' });
            
            const today = new Date().toLocaleDateString('ar-SA');
            doc.text(`ุงูุชุงุฑูุฎ: ${today}`, 105, 220, { align: 'center' });
            
            doc.save(`ุดูุงุฏุฉ_${name}_${title}.pdf`);
        }

        // Export data
        function exportData() {
            showModal('exportModal');
        }

        function performExport() {
            const type = document.getElementById('exportType').value;
            const format = document.getElementById('exportFormat').value;
            
            const data = {
                teachers: teachers,
                classes: classes,
                date: new Date().toLocaleDateString('ar-SA'),
                type: type
            };
            
            if (format === 'excel') {
                exportToExcel(data);
            } else if (format === 'pdf') {
                exportToPDF(data);
            } else if (format === 'image') {
                exportToImage(data);
            }
            
            closeModal('exportModal');
        }

        function exportToExcel(data) {
            // Prepare data with correct order: Teacher Name first, then Class
            const exportData = data.teachers.map(teacher => ({
                'ุงุณู ุงููุนููุฉ': teacher.name,
                'ุงูุตู': teacher.class,
                'ุงูุญุงูุฉ': teacher.status === 'present' ? 'ุญุงุถุฑุฉ' : 
                         teacher.status === 'absent' ? 'ุบุงุฆุจุฉ' : 
                         teacher.status === 'excused' ? 'ุจุนุฐุฑ' : 'ูุชุฃุฎุฑุฉ'
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ุชูุฑูุฑ ุงูุญุถูุฑ');
            XLSX.writeFile(wb, `ุชูุฑูุฑ_${data.type}_${data.date}.xlsx`);
        }

        function exportToPDF(data) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text(`ุชูุฑูุฑ ${data.type} - ${data.date}`, 105, 30, { align: 'center' });
            
            let y = 60;
            data.teachers.forEach(teacher => {
                const statusText = teacher.status === 'present' ? 'ุญุงุถุฑุฉ' : 
                                 teacher.status === 'absent' ? 'ุบุงุฆุจุฉ' : 
                                 teacher.status === 'excused' ? 'ุจุนุฐุฑ' : 'ูุชุฃุฎุฑุฉ';
                doc.setFontSize(12);
                doc.text(`${teacher.name} - ${teacher.class} - ${statusText}`, 20, y);
                y += 10;
            });
            
            doc.save(`ุชูุฑูุฑ_${data.type}_${data.date}.pdf`);
        }

        function exportToImage(data) {
            // Create a canvas element to generate image
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 800;
            canvas.height = 600;
            
            // Draw report content
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`ุชูุฑูุฑ ${data.type} - ${data.date}`, canvas.width/2, 50);
            
            let y = 100;
            ctx.font = '14px Arial';
            ctx.textAlign = 'right';
            data.teachers.forEach(teacher => {
                const statusText = teacher.status === 'present' ? 'ุญุงุถุฑุฉ' : 
                                 teacher.status === 'absent' ? 'ุบุงุฆุจุฉ' : 
                                 teacher.status === 'excused' ? 'ุจุนุฐุฑ' : 'ูุชุฃุฎุฑุฉ';
                ctx.fillText(`${teacher.name} - ${teacher.class} - ${statusText}`, canvas.width - 50, y);
                y += 25;
            });
            
            // Download image
            const link = document.createElement('a');
            link.download = `ุชูุฑูุฑ_${data.type}_${data.date}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Reset system
        function resetSystem() {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงูุ ุณูุชู ุฅุนุงุฏุฉ ุชุนููู ุงูุญุถูุฑ ูุงูููุงุท ููุท.')) {
                teachers.forEach(teacher => {
                    teacher.status = 'absent';
                    teacher.dailyPoints = 0;
                });
                
                classes.forEach(classItem => {
                    classItem.dailyPoints = 0;
                    classItem.ratings = { quiet: 3, speed: 3, alignment: 3, noise: 3, cleanliness: 3 };
                });
                
                renderTeachers();
                renderClasses();
                updateStatistics();
                updateStars();
                saveData();
                
                alert('โ ุชู ุฅุนุงุฏุฉ ุชุนููู ุงูุญุถูุฑ ูุงูููุงุท ุจูุฌุงุญ!');
            }
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('โ๏ธ ุชุญุฐูุฑ: ูุฐุง ุณูุญุฐู ุฌููุน ุงูุจูุงูุงุช ููุงุฆูุงู!\n\nโข ุฌููุน ุงููุนููุงุช\nโข ุฌููุน ุงูุตููู\nโข ุงูุฅุนุฏุงุฏุงุช (ุนุฏุง ูููุฉ ุงููุฑูุฑ)\n\nูู ุฃูุช ูุชุฃูุฏุ')) {
                if (confirm('๐จ ุชุฃููุฏ ุฃุฎูุฑ: ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุงูุจูุงูุงุชุ\n\nูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก!')) {
                    // Clear all data
                    teachers = [];
                    classes = [];
                    
                    // Reset settings but keep password
                    const currentPassword = systemSettings.password;
                    systemSettings = {
                        title: 'ุงูุทุงุจูุฑ ุงููุฏุฑุณู',
                        principalName: 'ุฃ. ูุงุทูุฉ ุงูุฃุญูุฏ',
                        password: currentPassword,
                        logo1: '',
                        logo2: ''
                    };
                    
                    // Clear all localStorage data
                    const keys = Object.keys(localStorage).filter(key => 
                        key.startsWith('schoolQueueData') || key === 'deviceId'
                    );
                    keys.forEach(key => localStorage.removeItem(key));
                    
                    // Clear sessionStorage
                    sessionStorage.clear();
                    
                    // Update displays
                    renderTeachers();
                    renderClasses();
                    updateStatistics();
                    updateStars();
                    loadSettings();
                    
                    // Save empty state
                    saveData();
                    
                    alert('๐๏ธ ุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุจูุฌุงุญ!\n\nโจ ุงููุธุงู ุงูุขู ูุงุฑุบ ููุณุชุนุฏ ูุฅุฏุฎุงู ุจูุงูุงุช ุฌุฏูุฏุฉ.');
                    
                    // Close admin section
                    showSection('teachers');
                }
            }
        }

        // Render teachers table
        function renderTeachersTable() {
            const tbody = document.getElementById('teachersTableBody');
            tbody.innerHTML = '';
            
            teachers.forEach((teacher, index) => {
                const statusTexts = {
                    present: 'ุญุงุถุฑุฉ',
                    absent: 'ุบุงุฆุจุฉ',
                    excused: 'ุจุนุฐุฑ',
                    late: 'ูุชุฃุฎุฑุฉ'
                };
                
                const statusColors = {
                    present: 'bg-green-100 text-green-800',
                    absent: 'bg-red-100 text-red-800',
                    excused: 'bg-yellow-100 text-yellow-800',
                    late: 'bg-orange-100 text-orange-800'
                };
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.onclick = () => toggleRowSelection(row);
                row.innerHTML = `
                    <td class="border border-gray-300 px-4 py-2 text-center">${index + 1}</td>
                    <td class="border border-gray-300 px-4 py-2">${teacher.name}</td>
                    <td class="border border-gray-300 px-4 py-2 text-center">${teacher.class}</td>
                    <td class="border border-gray-300 px-4 py-2 text-center">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColors[teacher.status]}">
                            ${statusTexts[teacher.status]}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2 text-center">${teacher.dailyPoints}</td>
                    <td class="border border-gray-300 px-4 py-2 text-center">${teacher.monthlyPoints}</td>
                    <td class="border border-gray-300 px-4 py-2 text-center">
                        <div class="flex gap-1 justify-center">
                            <button onclick="editTeacher(${teacher.id}); event.stopPropagation();" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600">
                                โ๏ธ
                            </button>
                            <button onclick="deleteTeacher(${teacher.id}); event.stopPropagation();" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">
                                ๐๏ธ
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Toggle row selection
        function toggleRowSelection(row) {
            if (row.classList.contains('bg-blue-100')) {
                row.classList.remove('bg-blue-100');
            } else {
                row.classList.add('bg-blue-100');
            }
        }
        
        // Select all table rows
        function selectAllTable() {
            const rows = document.querySelectorAll('#teachersTableBody tr');
            const allSelected = Array.from(rows).every(row => row.classList.contains('bg-blue-100'));
            
            rows.forEach(row => {
                if (allSelected) {
                    row.classList.remove('bg-blue-100');
                } else {
                    row.classList.add('bg-blue-100');
                }
            });
        }
        
        // Copy table data
        function copyTableData() {
            const selectedRows = document.querySelectorAll('#teachersTableBody tr.bg-blue-100');
            let textToCopy = '';
            
            if (selectedRows.length === 0) {
                // Copy all data if nothing is selected
                textToCopy = 'ุงุณู ุงููุนููุฉ\tุงูุตู\tุงูุญุงูุฉ\tููุงุท ุงูููู\tููุงุท ุงูุดูุฑ\n';
                teachers.forEach(teacher => {
                    const statusTexts = {
                        present: 'ุญุงุถุฑุฉ',
                        absent: 'ุบุงุฆุจุฉ',
                        excused: 'ุจุนุฐุฑ',
                        late: 'ูุชุฃุฎุฑุฉ'
                    };
                    textToCopy += `${teacher.name}\t${teacher.class}\t${statusTexts[teacher.status]}\t${teacher.dailyPoints}\t${teacher.monthlyPoints}\n`;
                });
            } else {
                // Copy only selected rows
                textToCopy = 'ุงุณู ุงููุนููุฉ\tุงูุตู\tุงูุญุงูุฉ\tููุงุท ุงูููู\tููุงุท ุงูุดูุฑ\n';
                selectedRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const name = cells[1].textContent;
                    const className = cells[2].textContent;
                    const status = cells[3].textContent.trim();
                    const dailyPoints = cells[4].textContent;
                    const monthlyPoints = cells[5].textContent;
                    textToCopy += `${name}\t${className}\t${status}\t${dailyPoints}\t${monthlyPoints}\n`;
                });
            }
            
            // Copy to clipboard
            navigator.clipboard.writeText(textToCopy).then(() => {
                const count = selectedRows.length === 0 ? teachers.length : selectedRows.length;
                alert(`โ ุชู ูุณุฎ ${count} ุตู ุฅูู ุงูุญุงูุธุฉ!\n\n๐ก ููููู ุงูุขู ูุตููุง ูู Excel ุฃู ุฃู ุจุฑูุงูุฌ ุขุฎุฑ`);
                
                // Clear selection after copying
                selectedRows.forEach(row => row.classList.remove('bg-blue-100'));
            }).catch(() => {
                alert('โ ูุดู ูู ูุณุฎ ุงูุจูุงูุงุช. ุชุฃูุฏ ูู ุฃู ุงููุชุตูุญ ูุฏุนู ุงููุณุฎ.');
            });
        }
        
        // Edit teacher
        function editTeacher(teacherId) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (teacher) {
                const newName = prompt('ุงุณู ุงููุนููุฉ ุงูุฌุฏูุฏ:', teacher.name);
                const newClass = prompt('ุงูุตู ุงูุฌุฏูุฏ:', teacher.class);
                
                if (newName && newClass) {
                    teacher.name = newName;
                    teacher.class = newClass;
                    renderTeachers();
                    renderTeachersTable();
                    saveData();
                    alert('โ ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงููุนููุฉ ุจูุฌุงุญ!');
                }
            }
        }
        
        // Delete teacher
        function deleteTeacher(teacherId) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (teacher && confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุนููุฉ "${teacher.name}"ุ`)) {
                teachers = teachers.filter(t => t.id !== teacherId);
                renderTeachers();
                renderTeachersTable();
                updateStatistics();
                updateStars();
                saveData();
                alert('โ ุชู ุญุฐู ุงููุนููุฉ ุจูุฌุงุญ!');
            }
        }

        // Enhanced data persistence with automatic saving and cloud sync simulation
        function saveData() {
            const dataToSave = {
                teachers: teachers,
                classes: classes,
                settings: systemSettings,
                lastUpdated: new Date().toISOString(),
                version: '3.0',
                deviceId: getDeviceId()
            };
            
            // Save to localStorage (primary storage)
            localStorage.setItem('schoolQueueData', JSON.stringify(dataToSave));
            
            // Save to sessionStorage as backup
            sessionStorage.setItem('schoolQueueData', JSON.stringify(dataToSave));
            
            // Simulate cloud sync by saving with timestamp
            const cloudKey = 'schoolQueueData_cloud_' + new Date().getTime();
            localStorage.setItem(cloudKey, JSON.stringify(dataToSave));
            
            // Keep only last 5 cloud backups to avoid storage overflow
            cleanupCloudBackups();
            
            // Show save indicator
            showSaveStatus();
            
            console.log('โ ุชู ุญูุธ ุงูุจูุงูุงุช ููุฒุงููุชูุง ูู:', new Date().toLocaleString('ar-SA'));
        }
        
        // Get unique device identifier
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }
        
        // Clean up old cloud backups
        function cleanupCloudBackups() {
            const keys = Object.keys(localStorage).filter(key => key.startsWith('schoolQueueData_cloud_'));
            if (keys.length > 5) {
                // Sort by timestamp and remove oldest
                keys.sort().slice(0, keys.length - 5).forEach(key => {
                    localStorage.removeItem(key);
                });
            }
        }

        // Show save status indicator
        function showSaveStatus() {
            const saveStatus = document.getElementById('saveStatus');
            saveStatus.classList.remove('hidden');
            
            // Hide after 2 seconds
            setTimeout(() => {
                saveStatus.classList.add('hidden');
            }, 2000);
        }

        function loadData() {
            let saved = localStorage.getItem('schoolQueueData');
            
            // If localStorage is empty, try sessionStorage
            if (!saved) {
                saved = sessionStorage.getItem('schoolQueueData');
            }
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    console.log('๐ฅ ุชู ุชุญููู ุงูุจูุงูุงุช ุงููุญููุธุฉ ูู:', data.lastUpdated || 'ุบูุฑ ูุญุฏุฏ');
                    
                    // Load teachers data (empty array if no data)
                    teachers = data.teachers || [];
                    console.log(`๐ฉโ๐ซ ุชู ุชุญููู ${teachers.length} ูุนููุฉ`);
                    
                    // Load classes data (empty array if no data)
                    classes = data.classes || [];
                    console.log(`๐ซ ุชู ุชุญููู ${classes.length} ุตู`);
                    
                    // Load settings
                    if (data.settings) {
                        systemSettings = { ...systemSettings, ...data.settings };
                        console.log('โ๏ธ ุชู ุชุญููู ุฅุนุฏุงุฏุงุช ุงููุธุงู');
                    }
                    
                } catch (error) {
                    console.error('โ ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช:', error);
                    // Start with empty data if loading fails
                    teachers = [];
                    classes = [];
                }
            } else {
                // No saved data, start empty
                teachers = [];
                classes = [];
                console.log('๐ ุงููุธุงู ูุจุฏุฃ ูุงุฑุบุงู - ุฃุถู ุงููุนููุงุช ูุงูุตููู ูู ุงูุฅุนุฏุงุฏุงุช');
            }
        }

        // Auto-save function that runs periodically
        function autoSave() {
            saveData();
        }

        // Save data whenever the page is about to be closed or refreshed
        window.addEventListener('beforeunload', function(e) {
            saveData();
        });

        // Save data when the page loses focus (user switches tabs/apps)
        window.addEventListener('blur', function() {
            saveData();
        });

        // Save data when the page gains focus (user returns to tab)
        window.addEventListener('focus', function() {
            saveData();
        });

        function loadSettings() {
            // Settings are already loaded in init(), just update display
            document.getElementById('mainTitle').textContent = systemSettings.title;
            document.getElementById('principalName').textContent = systemSettings.principalName;
            
            // Load saved logos
            if (systemSettings.logo1) {
                const logoContainer = document.getElementById('logoContainer');
                logoContainer.innerHTML = `<img src="${systemSettings.logo1}" alt="ุดุนุงุฑ ุฃูู" class="w-16 h-16 rounded-full object-cover">`;
            }
            
            if (systemSettings.logo2) {
                const logoContainer2 = document.getElementById('logoContainer2');
                logoContainer2.innerHTML = `<img src="${systemSettings.logo2}" alt="ุดุนุงุฑ ุซุงูู" class="w-16 h-16 rounded-full object-cover">`;
            }
        }

        // Bulk add functions
        function addEmptyRow() {
            const tbody = document.getElementById('bulkAddTableBody');
            const rowCount = tbody.children.length + 1;
            
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50';
            row.innerHTML = `
                <td class="border border-gray-300 px-4 py-2 text-center">${rowCount}</td>
                <td class="border border-gray-300 px-2 py-1">
                    <input type="text" class="w-full p-2 border-0 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded" 
                           placeholder="ุงุณู ุงููุนููุฉ" onchange="updateRowNumbers()">
                </td>
                <td class="border border-gray-300 px-2 py-1">
                    <input type="text" class="w-full p-2 border-0 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded" 
                           placeholder="ุงูุตู" onchange="updateRowNumbers()">
                </td>
                <td class="border border-gray-300 px-2 py-1 text-center">
                    <button onclick="removeRow(this)" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">
                        ๐๏ธ
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        }
        
        function removeRow(button) {
            const row = button.closest('tr');
            row.remove();
            updateRowNumbers();
        }
        
        function updateRowNumbers() {
            const tbody = document.getElementById('bulkAddTableBody');
            const rows = tbody.querySelectorAll('tr');
            rows.forEach((row, index) => {
                const numberCell = row.querySelector('td:first-child');
                numberCell.textContent = index + 1;
            });
        }
        
        function clearTable() {
            const tbody = document.getElementById('bulkAddTableBody');
            tbody.innerHTML = '';
        }
        
        function clearPasteArea() {
            document.getElementById('bulkPasteArea').value = '';
        }
        
        function parsePastedData() {
            const pasteArea = document.getElementById('bulkPasteArea');
            const data = pasteArea.value.trim();
            
            if (!data) {
                alert('โ๏ธ ูุง ุชูุฌุฏ ุจูุงูุงุช ููุชุญููู!');
                return;
            }
            
            // Clear existing table
            clearTable();
            
            // Split by lines
            const lines = data.split('\n');
            let addedRows = 0;
            
            lines.forEach(line => {
                line = line.trim();
                if (line) {
                    // Try different separators: tab, comma, semicolon, multiple spaces
                    let parts = [];
                    
                    if (line.includes('\t')) {
                        parts = line.split('\t');
                    } else if (line.includes(',')) {
                        parts = line.split(',');
                    } else if (line.includes(';')) {
                        parts = line.split(';');
                    } else if (line.includes('  ')) {
                        parts = line.split(/\s{2,}/); // Multiple spaces
                    } else {
                        // Try to split by single space if it looks like "Name Class"
                        const spaceIndex = line.lastIndexOf(' ');
                        if (spaceIndex > 0) {
                            parts = [line.substring(0, spaceIndex), line.substring(spaceIndex + 1)];
                        } else {
                            parts = [line]; // Single column
                        }
                    }
                    
                    // Clean up parts
                    parts = parts.map(part => part.trim()).filter(part => part);
                    
                    if (parts.length >= 2) {
                        const teacherName = parts[0];
                        const className = parts[1];
                        
                        // Add row to table
                        const tbody = document.getElementById('bulkAddTableBody');
                        const rowCount = tbody.children.length + 1;
                        
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="border border-gray-300 px-4 py-2 text-center">${rowCount}</td>
                            <td class="border border-gray-300 px-2 py-1">
                                <input type="text" class="w-full p-2 border-0 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded" 
                                       value="${teacherName}" onchange="updateRowNumbers()">
                            </td>
                            <td class="border border-gray-300 px-2 py-1">
                                <input type="text" class="w-full p-2 border-0 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded" 
                                       value="${className}" onchange="updateRowNumbers()">
                            </td>
                            <td class="border border-gray-300 px-2 py-1 text-center">
                                <button onclick="removeRow(this)" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">
                                    ๐๏ธ
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                        addedRows++;
                    } else if (parts.length === 1 && parts[0]) {
                        // Single column - assume it's teacher name, let user add class
                        const teacherName = parts[0];
                        
                        const tbody = document.getElementById('bulkAddTableBody');
                        const rowCount = tbody.children.length + 1;
                        
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="border border-gray-300 px-4 py-2 text-center">${rowCount}</td>
                            <td class="border border-gray-300 px-2 py-1">
                                <input type="text" class="w-full p-2 border-0 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded" 
                                       value="${teacherName}" onchange="updateRowNumbers()">
                            </td>
                            <td class="border border-gray-300 px-2 py-1">
                                <input type="text" class="w-full p-2 border-0 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded" 
                                       placeholder="ุฃุฏุฎู ุงูุตู" onchange="updateRowNumbers()">
                            </td>
                            <td class="border border-gray-300 px-2 py-1 text-center">
                                <button onclick="removeRow(this)" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">
                                    ๐๏ธ
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                        addedRows++;
                    }
                }
            });
            
            if (addedRows > 0) {
                alert(`โ ุชู ุชุญููู ุงูุจูุงูุงุช ุจูุฌุงุญ!\n๐ ุชู ุฅุถุงูุฉ ${addedRows} ุตู ุฅูู ุงูุฌุฏูู\n\n๐ก ููููู ุงูุขู ุชุนุฏูู ุงูุจูุงูุงุช ูู ุงูุฌุฏูู ูุจู ุงูุญูุธ`);
                // Clear paste area after successful parsing
                pasteArea.value = '';
            } else {
                alert('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุตุงูุญุฉ!\n\n๐ก ุชุฃูุฏ ูู ุฃู ุงูุจูุงูุงุช ุจุงูุดูู ุงูุชุงูู:\nุงุณู ุงููุนููุฉ	ุงูุตู\nุฃู\nุงุณู ุงููุนููุฉ,ุงูุตู');
                // Add some empty rows for manual entry
                for (let i = 0; i < 3; i++) {
                    addEmptyRow();
                }
            }
        }
        
        function saveBulkTeachers() {
            const tbody = document.getElementById('bulkAddTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            let addedCount = 0;
            let classesAdded = 0;
            const newClasses = new Set();
            
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                const teacherName = inputs[0].value.trim();
                const className = inputs[1].value.trim();
                
                if (teacherName && className) {
                    // Check if teacher already exists
                    const existingTeacher = teachers.find(t => 
                        t.name.toLowerCase() === teacherName.toLowerCase() && 
                        t.class.toLowerCase() === className.toLowerCase()
                    );
                    
                    if (!existingTeacher) {
                        // Add teacher
                        const newId = Math.max(...teachers.map(t => t.id), 0) + 1;
                        teachers.push({
                            id: newId,
                            name: teacherName,
                            class: className,
                            status: 'absent',
                            dailyPoints: 0,
                            monthlyPoints: 0
                        });
                        addedCount++;
                        
                        // Add unique classes
                        if (!classes.find(c => c.name.toLowerCase() === className.toLowerCase())) {
                            newClasses.add(className);
                        }
                    }
                }
            });
            
            // Add new classes
            newClasses.forEach(className => {
                const newId = Math.max(...classes.map(c => c.id), 0) + 1;
                classes.push({
                    id: newId,
                    name: className,
                    dailyPoints: 0,
                    monthlyPoints: 0,
                    ratings: { quiet: 3, speed: 3, alignment: 3, noise: 3, cleanliness: 3 }
                });
                classesAdded++;
            });
            
            if (addedCount > 0) {
                // Force immediate save
                saveData();
                
                // Update displays
                renderTeachers();
                renderClasses();
                renderTeachersTable();
                updateStatistics();
                updateStars();
                
                // Save again after updates to ensure everything is captured
                setTimeout(() => {
                    saveData();
                    console.log('๐ ุชู ุญูุธ ุงูุจูุงูุงุช ุงููุถุงูุฉ ุจุงูุฌููุฉ ุจุดูู ุฏุงุฆู');
                }, 500);
                
                // Close modal
                closeModal('bulkAddModal');
                
                // Show success message
                alert(`๐ ุชู ุฅุถุงูุฉ ุงูุจูุงูุงุช ูุญูุธูุง ุจูุฌุงุญ!\n\n๐ฉโ๐ซ ุงููุนููุงุช ุงููุถุงูุฉ: ${addedCount}\n๐ซ ุงูุตููู ุงูุฌุฏูุฏุฉ: ${classesAdded}\n\n๐พ ุงูุจูุงูุงุช ูุญููุธุฉ ุจุดูู ุฏุงุฆู ููู ุชุฎุชูู!\n\nโจ ููููู ุงูุขู ุฑุคูุฉ ุงููุนููุงุช ูู ูุณู "ุญุถูุฑ ุงููุนููุงุช"`);
                
                // Switch to teachers section
                showSection('teachers');
            } else {
                alert('โ๏ธ ูู ูุชู ุฅุถุงูุฉ ุฃู ูุนููุงุช!\n\n๐ก ุชุฃูุฏ ูู:\nโข ุฅุฏุฎุงู ุงุณู ุงููุนููุฉ ูุงูุตู\nโข ุนุฏู ูุฌูุฏ ูุนููุงุช ููุฑุฑุฉ');
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97fa7204b538127c',t:'MTc1Nzk2MzY0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
